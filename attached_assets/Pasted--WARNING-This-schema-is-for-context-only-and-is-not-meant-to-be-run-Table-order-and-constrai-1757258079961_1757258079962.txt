-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.commissions (
  id integer NOT NULL DEFAULT nextval('commissions_id_seq'::regclass),
  agentId character varying NOT NULL,
  subscriptionId integer NOT NULL,
  userId character varying NOT NULL,
  planName character varying NOT NULL,
  planType character varying NOT NULL,
  planTier character varying NOT NULL,
  commissionAmount numeric NOT NULL,
  totalPlanCost numeric NOT NULL,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  paymentStatus character varying DEFAULT 'unpaid'::character varying,
  paidDate timestamp without time zone,
  cancellationDate timestamp without time zone,
  cancellationReason text,
  createdAt timestamp without time zone DEFAULT now(),
  updatedAt timestamp without time zone DEFAULT now(),
  CONSTRAINT commissions_pkey PRIMARY KEY (id),
  CONSTRAINT commissions_subscriptionId_fkey FOREIGN KEY (subscriptionId) REFERENCES public.subscriptions(id),
  CONSTRAINT commissions_agentId_fkey FOREIGN KEY (agentId) REFERENCES public.users(id),
  CONSTRAINT commissions_userId_fkey FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.enrollment_modifications (
  id integer NOT NULL DEFAULT nextval('enrollment_modifications_id_seq'::regclass),
  user_id character varying NOT NULL,
  subscription_id integer,
  modified_by character varying NOT NULL,
  change_type character varying NOT NULL,
  change_details jsonb,
  consent_type character varying,
  consent_notes text,
  consent_date timestamp without time zone,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT enrollment_modifications_pkey PRIMARY KEY (id),
  CONSTRAINT enrollment_modifications_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id),
  CONSTRAINT enrollment_modifications_modified_by_fkey FOREIGN KEY (modified_by) REFERENCES public.users(id),
  CONSTRAINT enrollment_modifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.family_members (
  id integer NOT NULL DEFAULT nextval('family_members_id_seq'::regclass),
  primary_user_id character varying NOT NULL,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  middle_name character varying,
  date_of_birth character varying,
  gender character varying,
  ssn character varying,
  email character varying,
  phone character varying,
  relationship character varying,
  member_type character varying NOT NULL,
  address text,
  address2 text,
  city character varying,
  state character varying,
  zip_code character varying,
  plan_start_date character varying,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT family_members_pkey PRIMARY KEY (id),
  CONSTRAINT family_members_primary_user_id_fkey FOREIGN KEY (primary_user_id) REFERENCES public.users(id)
);
CREATE TABLE public.lead_activities (
  id integer NOT NULL DEFAULT nextval('lead_activities_id_seq'::regclass),
  lead_id integer,
  agent_id character varying,
  activity_type character varying,
  notes text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT lead_activities_pkey PRIMARY KEY (id),
  CONSTRAINT lead_activities_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.leads(id)
);
CREATE TABLE public.leads (
  id integer NOT NULL DEFAULT nextval('leads_id_seq'::regclass),
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  email character varying NOT NULL,
  phone character varying NOT NULL,
  message text,
  source character varying DEFAULT 'contact_form'::character varying,
  status character varying DEFAULT 'new'::character varying,
  assigned_agent_id character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  notes text,
  CONSTRAINT leads_pkey PRIMARY KEY (id)
);
CREATE TABLE public.payments (
  id integer NOT NULL DEFAULT nextval('payments_id_seq'::regclass),
  user_id character varying NOT NULL,
  subscription_id integer,
  amount numeric NOT NULL,
  status character varying NOT NULL,
  stripe_payment_intent_id character varying UNIQUE,
  stripe_charge_id character varying,
  payment_method character varying,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT payments_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id)
);
CREATE TABLE public.plans (
  id integer NOT NULL DEFAULT nextval('plans_id_seq'::regclass),
  name character varying NOT NULL,
  description text,
  price numeric NOT NULL,
  billing_period character varying DEFAULT 'monthly'::character varying,
  features jsonb,
  max_members integer DEFAULT 1,
  is_active boolean DEFAULT true,
  stripe_price_id character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT plans_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sessions (
  sid character varying NOT NULL,
  sess jsonb NOT NULL,
  expire timestamp without time zone NOT NULL,
  CONSTRAINT sessions_pkey PRIMARY KEY (sid)
);
CREATE TABLE public.subscriptions (
  id integer NOT NULL DEFAULT nextval('subscriptions_id_seq'::regclass),
  user_id character varying NOT NULL,
  plan_id integer NOT NULL,
  status character varying NOT NULL,
  pending_reason character varying,
  pending_details text,
  start_date timestamp without time zone DEFAULT now(),
  end_date timestamp without time zone,
  next_billing_date timestamp without time zone,
  amount numeric NOT NULL,
  stripe_subscription_id character varying UNIQUE,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT subscriptions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.plans(id),
  CONSTRAINT subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id character varying NOT NULL,
  email character varying UNIQUE,
  first_name character varying,
  last_name character varying,
  middle_name character varying,
  profile_image_url character varying,
  phone character varying,
  date_of_birth character varying,
  gender character varying,
  address text,
  address2 text,
  city character varying,
  state character varying,
  zip_code character varying,
  emergency_contact_name character varying,
  emergency_contact_phone character varying,
  stripe_customer_id character varying UNIQUE,
  stripe_subscription_id character varying UNIQUE,
  role character varying DEFAULT 'user'::character varying,
  agent_number character varying UNIQUE,
  is_active boolean DEFAULT true,
  approval_status character varying DEFAULT 'pending'::character varying,
  approved_at timestamp without time zone,
  approved_by character varying,
  rejection_reason text,
  email_verified boolean DEFAULT false,
  email_verified_at timestamp without time zone,
  registration_ip character varying,
  registration_user_agent text,
  suspicious_flags jsonb,
  enrolled_by_agent_id character varying,
  employer_name character varying,
  division_name character varying,
  member_type character varying,
  ssn character varying,
  date_of_hire character varying,
  plan_start_date character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  username character varying,
  password_hash text,
  email_verification_token text,
  reset_password_token text,
  reset_password_expiry timestamp without time zone,
  last_login_at timestamp without time zone,
  google_id character varying,
  facebook_id character varying,
  apple_id character varying,
  microsoft_id character varying,
  linkedin_id character varying,
  twitter_id character varying,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);